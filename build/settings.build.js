(()=>{"use strict";var e={n:s=>{var n=s&&s.__esModule?()=>s.default:()=>s;return e.d(n,{a:n}),n},d:(s,n)=>{for(var t in n)e.o(n,t)&&!e.o(s,t)&&Object.defineProperty(s,t,{enumerable:!0,get:n[t]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};const s=window.React;var n=e.n(s);const t=window.wp.element,a=window.wp.i18n,i=window.wp.components,r=window.wp.apiFetch;var o=e.n(r);const c=window.ReactJSXRuntime,p=()=>{const{baseUrl:e,setBaseUrl:s,companyName:r,setCompanyName:p,apiUsername:l,setApiUsername:_,apiPassword:d,setApiPassword:y,isTesting:u,setIsTesting:h,isSaving:m,setIsSaving:g,message:w,setMessage:v,handleSave:x,handleTestConnection:S,saveSettings:C,wcVersion:P,syncType:j,setSyncType:b}=(()=>{const[e,s]=(0,t.useState)(""),[n,i]=(0,t.useState)(""),[r,c]=(0,t.useState)(""),[p,l]=(0,t.useState)(""),[_,d]=(0,t.useState)(!1),[y,u]=(0,t.useState)(!1),[h,m]=(0,t.useState)(!1),[g,w]=(0,t.useState)(""),[v,x]=(0,t.useState)(""),[S,C]=(0,t.useState)("update");return(0,t.useEffect)((()=>{o()({path:"/wp/v2/settings"}).then((e=>{const n=e;s(n.spire_sync_settings.spire_api.base_url||""),i(n.spire_sync_settings.spire_api.company_name||""),c(n.spire_sync_settings.spire_api.api_username||""),l(n.spire_sync_settings.spire_api.api_password||"")})),o()({path:"/wc/v3/system_status"}).then((e=>{var s;const n=null!==(s=e.environment.version)&&void 0!==s?s:"";x(n)}))}),[]),{baseUrl:e,setBaseUrl:s,companyName:n,setCompanyName:i,apiUsername:r,setApiUsername:c,apiPassword:p,setApiPassword:l,isTesting:_,setIsTesting:d,isSaving:y,setIsSaving:u,isValidConnection:h,setIsValidConnection:m,message:g,setMessage:w,handleTestConnection:async()=>{d(!0),w("");let s={success:!1,message:""};o()({path:"/spire_sync/v1/test-connection",method:"POST",data:{base_url:e,company_name:n,api_username:r,api_password:p}}).then((e=>{s=e,s.success||(d(!1),m(!1),w((0,a.__)("Invalid credentials. Please try again.","spire-sync"))),d(!1),m(!0),w((0,a.__)("Connection successful!","spire-sync"))})).catch((e=>{d(!1),m(!1),w((0,a.__)("An error occurred while testing the connection. Please try again later.","spire-sync")),console.error(e)}))},handleSave:async()=>{u(!0),w("")},saveSettings:async()=>{u(!0),w(""),o()({path:"/wp/v2/settings",method:"POST",data:{spire_sync_settings:{spire_api:{base_url:e,company_name:n,api_username:r,api_password:p}}}}).then((e=>{console.log("Settings saved:",e),w((0,a.__)("Settings saved successfully.","spire-sync")),u(!1)})).catch((e=>{w((0,a.__)("Error saving settings.","spire-sync")),u(!1),console.error(e)}))},wcVersion:v,syncType:S,setSyncType:C}})();return(0,c.jsxs)("div",{className:"spire-sync-settings-container",children:[(0,c.jsx)("h1",{children:(0,a.__)("Spire Sync Settings","spire-sync")}),w&&(0,c.jsx)(i.Notice,{status:"success",isDismissible:!0,onDismiss:()=>v(""),children:w}),(0,c.jsx)(i.Panel,{header:"Settings",children:(0,c.jsx)(n().Fragment,{children:(0,c.jsxs)(i.PanelBody,{title:(0,a.__)("API Settings","spire-sync"),initialOpen:!0,children:[(0,c.jsx)(i.PanelRow,{children:(0,c.jsx)(i.__experimentalInputControl,{__next40pxDefaultSize:!0,label:(0,a.__)("Base URL","spire-sync"),value:e,onChange:e=>s(e||""),help:(0,a.__)("Enter the base URL for the Spire API (e.g., http://example.com/api/v2)","spire-sync"),style:{width:"400px"}})}),(0,c.jsx)(i.PanelRow,{children:(0,c.jsx)(i.__experimentalInputControl,{__next40pxDefaultSize:!0,label:(0,a.__)("Company Name","spire-sync"),value:r,onChange:e=>p(e||""),style:{width:"400px"}})}),(0,c.jsx)(i.PanelRow,{children:(0,c.jsx)(i.__experimentalInputControl,{__next40pxDefaultSize:!0,label:(0,a.__)("API Username","spire-sync"),value:l,onChange:e=>_(e||""),style:{width:"400px"}})}),(0,c.jsx)(i.PanelRow,{children:(0,c.jsx)(i.__experimentalInputControl,{__next40pxDefaultSize:!0,label:(0,a.__)("API Password","spire-sync"),type:"password",value:d,onChange:e=>y(e||""),style:{width:"400px"}})}),(0,c.jsx)(i.PanelRow,{children:(0,c.jsx)(i.SelectControl,{__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0,label:(0,a.__)("Sync Type","spire-sync"),value:j,options:[{label:(0,a.__)("Create Only","spire-sync"),value:"create"},{label:(0,a.__)("Update Only","spire-sync"),value:"update"},{label:(0,a.__)("Create & Update","spire-sync"),value:"create-update"},{label:(0,a.__)("Create, Update, & Delete","spire-sync"),value:"create-update-delete"}],onChange:b,style:{width:"400px"}})}),(0,c.jsx)(i.PanelRow,{children:(0,c.jsx)(i.Button,{variant:"secondary",onClick:S,disabled:u,children:u?(0,a.__)("Testing...","spire-sync"):(0,a.__)("Test Connection","spire-sync")})})]})},"0")}),(0,c.jsx)(i.Button,{variant:"primary",onClick:C,disabled:m,children:m?(0,a.__)("Saving...","spire-sync"):(0,a.__)("Save Settings","spire-sync")})]})};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("spire-sync-settings-root");e&&(0,t.createRoot)(e).render((0,c.jsx)(p,{}))}))})();