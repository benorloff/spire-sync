(()=>{"use strict";var e={n:s=>{var t=s&&s.__esModule?()=>s.default:()=>s;return e.d(t,{a:t}),t},d:(s,t)=>{for(var n in t)e.o(t,n)&&!e.o(s,n)&&Object.defineProperty(s,n,{enumerable:!0,get:t[n]})},o:(e,s)=>Object.prototype.hasOwnProperty.call(e,s)};const s=window.React;var t=e.n(s);const n=window.wp.element,a=window.wp.i18n,i=window.wp.components,r=window.wp.data,o=window.wp.apiFetch;var c=e.n(o);const p="spire-sync-store",l="SET_BASE_URL",_="SET_COMPANY_NAME",d="SET_API_USERNAME",y="SET_API_PASSWORD",m="RECEIVE_SETTINGS",u="FETCH_SETTINGS",g="SAVE_SETTINGS",S={base_url:"",company_name:"",api_username:"",api_password:""},h={setBaseUrl:e=>({type:l,payload:{base_url:e}}),setCompanyName:e=>({type:_,payload:{company_name:e}}),setApiUsername:e=>({type:d,payload:{api_username:e}}),setApiPassword:e=>({type:y,payload:{api_password:e}}),receiveSettings:e=>({type:m,payload:e}),fetchSettings:()=>({type:u}),saveSettings:e=>({type:g,payload:e})},w={getBaseUrl:e=>e.base_url,getCompanyName:e=>e.company_name,getApiUsername:e=>e.api_username,getApiPassword:e=>e.api_password},x={*fetchSettings(e,s){const t=(yield c()({path:"/wp/v2/settings"})).spire_sync_settings||{};s.dispatch(p).receiveSettings(t)},*saveSettings(e,s){const t=e.payload;yield c()({path:"/wp/v2/settings",method:"POST",data:{spire_sync_settings:t}}),yield s.dispatch(p).fetchSettings()}},v=(0,r.createReduxStore)(p,{reducer:function(e=S,s){switch(s.type){case l:case _:case d:case y:case m:case u:case g:return{...e,...s.payload}}return e},actions:h,selectors:w,resolvers:x});(0,r.register)(v);const{setBaseUrl:C,setCompanyName:P,setApiUsername:j,setApiPassword:b,fetchSettings:f,saveSettings:A,receiveSettings:E}=h,{getBaseUrl:T,getCompanyName:I,getApiUsername:U,getApiPassword:N}=w,R=window.ReactJSXRuntime,B=()=>{const{base_url:e,company_name:o,api_username:l,api_password:_}=(0,r.useSelect)((e=>{const s=e(p);return{base_url:s.getBaseUrl(),company_name:s.getCompanyName(),api_username:s.getApiUsername(),api_password:s.getApiPassword()}}),[]),{setBaseUrl:d,setCompanyName:y,setApiUsername:m,setApiPassword:u,saveSettings:g,fetchSettings:S}=(0,r.useDispatch)(p);(0,s.useEffect)((()=>{S()}),[]),(0,s.useEffect)((()=>{console.log("Settings loaded:",{base_url:e,company_name:o,api_username:l})}),[e,o,l]);const{message:h,setMessage:w,isTesting:x,isSaving:v,setIsSaving:C,isValidConnection:P,wcVersion:j,handleTestConnection:b}=(()=>{const[e,s]=(0,n.useState)({isSaving:!1,isTesting:!1,isValidConnection:!1,message:"",wcVersion:""}),[t,i]=(0,n.useState)(""),[r,o]=(0,n.useState)(""),[p,l]=(0,n.useState)(""),[_,d]=(0,n.useState)(""),[y,m]=(0,n.useState)("update"),[u,g]=(0,n.useState)(!1),[S,h]=(0,n.useState)(!1),[w,x]=(0,n.useState)(!1),[v,C]=(0,n.useState)(!1),[P,j]=(0,n.useState)(!1),[b,f]=(0,n.useState)(""),[A,E]=(0,n.useState)(!1),[T,I]=(0,n.useState)("");return(0,n.useEffect)((()=>{c()({path:"/wp/v2/settings"}).then((e=>{const s=e;console.log("spire_sync_settings",s.spire_sync_settings),i(s.spire_sync_settings.base_url||""),o(s.spire_sync_settings.company_name||""),l(s.spire_sync_settings.api_username||""),d(s.spire_sync_settings.api_password||""),m(s.spire_sync_settings.sync_type||"update"),g(s.spire_sync_settings.sync_products||!1),h(s.spire_sync_settings.sync_orders||!1),x(s.spire_sync_settings.sync_customers||!1)})),c()({path:"/wc/v3/system_status"}).then((e=>{var s;const t=null!==(s=e.environment.version)&&void 0!==s?s:"";I(t)}))}),[]),{settings:e,setSettings:s,baseUrl:t,setBaseUrl:i,companyName:r,setCompanyName:o,apiUsername:p,setApiUsername:l,apiPassword:_,setApiPassword:d,syncType:y,setSyncType:m,syncProducts:u,setSyncProducts:g,syncOrders:S,setSyncOrders:h,syncCustomers:w,setSyncCustomers:x,message:b,setMessage:f,isTesting:P,setIsTesting:j,isValidConnection:A,setIsValidConnection:E,wcVersion:T,setWcVersion:I,isSaving:v,setIsSaving:C,handleTestConnection:async({base_url:e,company_name:s,api_username:t,api_password:n})=>{j(!0),f("");let i={success:!1,message:""};c()({path:"/spire_sync/v1/test-connection",method:"POST",data:{base_url:e,company_name:s,api_username:t,api_password:n}}).then((e=>{if(i=e,!i.success)return j(!1),E(!1),void f((0,a.__)("Invalid credentials. Please try again.","spire-sync"));j(!1),E(!0),f((0,a.__)("Connection successful!","spire-sync"))})).catch((e=>{j(!1),E(!1),f((0,a.__)("An error occurred while testing the connection.","spire-sync")),console.error(e)}))},saveSettings:async()=>{C(!0),f(""),c()({path:"/wp/v2/settings",method:"POST",data:{spire_sync_settings:{base_url:t,company_name:r,api_username:p,api_password:_}}}).then((e=>{console.log("Settings saved:",e),C(!1),f((0,a.__)("Settings saved successfully.","spire-sync"))})).catch((e=>{C(!1),f((0,a.__)("Error saving settings.","spire-sync")),console.error(e)}))}}})(),[f,A]=(0,s.useState)(!0);return(0,R.jsxs)("div",{className:"spire-sync-settings-container",children:[(0,R.jsx)("h1",{children:(0,a.__)("Spire Sync Settings","spire-sync")}),h&&(0,R.jsx)(i.Notice,{status:"success",isDismissible:!0,onDismiss:()=>w(""),children:h}),(0,R.jsx)(i.Panel,{header:"Settings",children:(0,R.jsx)(t().Fragment,{children:(0,R.jsxs)(i.PanelBody,{title:(0,a.__)("API Settings","spire-sync"),initialOpen:!0,children:[(0,R.jsx)(i.PanelRow,{children:(0,R.jsx)(i.__experimentalInputControl,{__next40pxDefaultSize:!0,label:(0,a.__)("Base URL","spire-sync"),value:e,onChange:e=>d(e||""),help:(0,a.__)("Enter the base URL for the Spire API (e.g., http://example.com/api/v2)","spire-sync"),style:{width:"400px"}})}),(0,R.jsx)(i.PanelRow,{children:(0,R.jsx)(i.__experimentalInputControl,{__next40pxDefaultSize:!0,label:(0,a.__)("Company Name","spire-sync"),value:o,onChange:e=>y(e||""),style:{width:"400px"}})}),(0,R.jsx)(i.PanelRow,{children:(0,R.jsx)(i.__experimentalInputControl,{__next40pxDefaultSize:!0,label:(0,a.__)("API Username","spire-sync"),value:l,onChange:e=>m(e||""),style:{width:"400px"}})}),(0,R.jsx)(i.PanelRow,{children:(0,R.jsx)(i.__experimentalInputControl,{__next40pxDefaultSize:!0,label:(0,a.__)("API Password","spire-sync"),type:"password",value:_,onChange:e=>u(e||""),style:{width:"400px"}})}),(0,R.jsx)(i.PanelRow,{children:(0,R.jsx)(i.Button,{variant:"secondary",onClick:b,disabled:x,children:x?(0,a.__)("Testing...","spire-sync"):(0,a.__)("Test Connection","spire-sync")})})]})},"0")}),(0,R.jsxs)(i.Card,{children:[(0,R.jsx)(i.CardHeader,{children:"Inventory Settings"}),(0,R.jsx)(i.CardBody,{children:(0,R.jsxs)(i.Flex,{children:[(0,R.jsxs)(i.FlexItem,{children:["Enable Inventory Sync",(0,R.jsx)(i.Tooltip,{placement:"right-end",text:"Enable this setting to sync inventory items from Spire to WooCommerce products.",children:(0,R.jsx)(i.Icon,{icon:"info-outline",style:{paddingLeft:"10px"}})})]}),(0,R.jsx)(i.FlexItem,{children:(0,R.jsx)(i.ToggleControl,{__nextHasNoMarginBottom:!0,label:"",checked:f,onChange:()=>A((e=>!e))})})]})})]}),(0,R.jsx)(i.Button,{variant:"primary",onClick:async()=>{w("");try{await b({base_url:e,company_name:o,api_username:l,api_password:_})}catch(e){return console.error("Error testing connection:",e),void w((0,a.__)("Error testing connection. Please check your credentials.","spire-sync"))}g({base_url:e,company_name:o,api_username:l,api_password:_}),w((0,a.__)("Settings saved successfully.","spire-sync"))},disabled:v,children:v?(0,a.__)("Saving...","spire-sync"):(0,a.__)("Save Settings","spire-sync")})]})};document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("spire-sync-settings-root");e&&(0,n.createRoot)(e).render((0,R.jsx)(B,{}))}))})();